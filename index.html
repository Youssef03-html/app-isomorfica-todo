<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>To-Do Isomórfica</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container">
    <h1>Lista de tareas</h1>

    <div class="add-task">
      <input type="text" id="task-input" placeholder="Nueva tarea">
      <button onclick="addTask()">Añadir</button>
    </div>

    <ul id="task-list"></ul>
  </div>

  <script>
        async function loadTasks() {
        const response = await fetch('/api/tasks');
        const tasks = await response.json();

        const list = document.getElementById('task-list');
        list.innerHTML = '';

        tasks.forEach(task => {
            const li = document.createElement('li');

            const text = document.createElement('span');
            text.textContent = task.title;

            if (task.completed) {
            text.classList.add('completed');
            }

            const toggleBtn = document.createElement('button');
            toggleBtn.textContent = task.completed ? 'Deshacer' : 'Completar';
            toggleBtn.onclick = async () => {
            await fetch(`/api/tasks/${task.id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ completed: !task.completed })
            });
            loadTasks();
            };

            const editBtn = document.createElement('button');
            editBtn.textContent = 'Editar';
            editBtn.onclick = async () => {
            const newTitle = prompt('Nuevo título:', task.title);
            if (!newTitle || newTitle.trim() === '') return;

            await fetch(`/api/tasks/${task.id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: newTitle })
            });

            loadTasks();
            };

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Eliminar';
            deleteBtn.onclick = async () => {
            await fetch(`/api/tasks/${task.id}`, { method: 'DELETE' });
            loadTasks();
            };

            li.appendChild(text);
            li.appendChild(toggleBtn);
            li.appendChild(editBtn);
            li.appendChild(deleteBtn);

            list.appendChild(li);
        });
        }

        async function addTask() {
        const input = document.getElementById('task-input');
        const title = input.value;

        if (title.trim() === '') return;

        await fetch('/api/tasks', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title })
        });

        input.value = '';
        loadTasks();
        }

        window.onload = loadTasks;
  </script>

</body>
</html>
